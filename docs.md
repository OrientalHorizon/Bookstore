# Bookstore 开发文档

Written by OrientalHorizon/马逸飞

这是上海交通大学 ACM 班的第五次 lab：书店管理系统。

### 程序功能概述

我们需要实现一个使用命令行交互的书店管理系统，为不同类型的账户（店主、员工、顾客、访客）提供购买书籍、查找书籍、编辑相关信息、图书进货、查看日志等功能。

#### 1. 交互方式

基础任务仅需实现命令行交互。具体的交互命令与规则参考 [作业发布仓库](https://github.com/ACMClassCourse-2022/Bookstore-2022/blob/master/requirements.md#交互方式)。

#### 2. 账户相关

对于一个账户，需要存储、可能会更改（只允许更改部分）的信息主要有：ID、用户名、权限、密码等。

可以实现的操作：注册账户（游客及以上）、创建账户（员工及以上）、登录、修改密码、退出登录（注销）、销号。

#### 3. 图书相关

图书所含的信息有：ISBN (Internal Strange Book Number)、书名、作者、关键词、购买数量、单价、交易总额。

可以实现的操作：检索图书（顾客及以上）、购买图书、选择一本书更改信息、进货。

#### 4. 日志相关

需要实现财务系统查询（收入支出），和生成完整日志两个操作。

#### 5. 错误处理

[作业发布仓库](https://github.com/ACMClassCourse-2022/Bookstore-2022/blob/master/requirements.md) 中几乎每条指令均可能出现不合法操作，需要对这些不合法操作归类、判别并且输出对应报错。

### 主体逻辑

在 `main` 函数中逐条读入指令，按顺序操作。

在读入指令之后，先识别指令类型。对于不需查找书籍、账户信息的指令语法错误（例如附加参数为空或不合法）应当立刻抛出并交由错误处理函数处理。

对语法无误的指令，交由对应函数（程序）进行操作，操作过程中判定其他类型的错误。

每一个类型的处理函数都应当对特定的类进行操作，读入硬盘中相应文件添加 / 修改信息，并记录到日志中。

`main` 函数中应当实现一个登录栈，并且将当前账户的信息读入到内存中方便存取。

### 各程序介绍

`Bookstore.h`：头文件，对书店类（整体的一个大类，内含账户类、图书类、日志类等）的变量作定义，并给出接口。

`main.cpp`：处理指令，分配给各个函数作具体处理。以及对登录账户的控制，包括使用一个栈存储登录账户的嵌套情况。

- 内部应有处理指令（主要涉及字符串处理）的函数。还要实现抛出语法错误。

账户操作程序：不涉及图书的操作应当在此处完成。本程序要实现账户类，维护各个账户的信息，从硬盘中存取保存相应信息的文件。具体地，要实现账户的查找、信息变更与删除。

图书操作程序：涉及图书的操作应当在此处完成。本程序要实现图书类，维护每一本图书的信息，从硬盘中存取保存相应信息的文件，并将这些变更记录在 `log` 和 / 或 `financial-log` 中。具体地，应当高效地实现图书的创建、查找、信息变更。

日志操作程序：按照要求处理并输出财务日志和全部日志。读取 `log` 和 / 或 `financial-log` 并输出到 Terminal 中。

错误处理：对每种语法错误与非法操作报错，输出到命令行中。

### 各文件介绍

在根目录下应当有使用说明 `manual.txt`。

（Note: 本栏以下内容为暂定，不排除文件结构和功能有大的变动。）

账户信息存储在 `account` 文件中；通过 ID 到账户具体信息的索引（映射）信息存储在 `account-index` 中。

图书信息存储在 `book` 文件中；通过 ISBN、书名、作者、关键词到图书具体信息的索引（映射）信息分别存储在 `isbn-index`, `name-index`, `author-index`, `keyword-index` 中。

日志分为两类：财务日志 `financial-log` 和全部日志 `total-log`。

### 实现算法

每一个账户和每一本书的信息都顺序存储在相应的主文件中；块状链表用于将相应信息索引到主文件中的位置。